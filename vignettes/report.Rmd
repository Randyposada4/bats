---
title: " Summer Research Project: Bats "
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{report}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
highlight: Tango
theme: Sandstone
---

***
#### *By Randy Posada*
```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include= FALSE}
library(rotl)
library(devtools)
library(stringr)
library(datelife)
```

```{r out.width = "100%",out.height= "50%", fig.align = "center", echo=FALSE }
knitr::include_graphics("../images/Batphoto1.jpg")
```
*Fig.cap="[See attributions for link](#Attributions)*
```{r}
getwd()

```
***

# **My Report**

## *Overview*

  In this report I use the OpenTree of life alongside Physcraper to create and access an updated phylogentic tree of all bats.

  There are over 1000 different species of bats. These extraordinary flying mammals use their hands to fly; granted their order name *chiroptera*, which translates in Greek to 'Hand Wings'. Each of their fingers are connected to one another through a thin layer of skin which allows these nocturnal mammals to take off into flight. Chiroptera are the only mammals with the capability of continued flight. 

***


```{r}

my_taxa <- c("chiroptera")
resolved_names <- rotl::tnrs_match_names(names = my_taxa)

resolved_names

```

```{r}
class(resolved_names)


```
```{r}
resolved_names[1,]

```

```{r}
resolved_names[1,"unique_name"]
```

This gives all info from the current OpenTree synthetic tree
```{r}
rotl::tol_about()
```

This gets Chiroptera OTT id:
```{r}
chiroptera_ott_id <- rotl::tnrs_match_names("Chiroptera")$ott_id
chiroptera_ott_id
```


```{r}
chiroptera_subtree <- rotl::tol_subtree(ott_id = chiroptera_ott_id)

ape::Ntip(chiroptera_subtree)

ape::plot.phylo(chiroptera_subtree, cex = 0.1, type = "fan") 
# or just plot(my_tree, cex = 0.1)
# because it ha sno branch lengths, it does not plot pretty. We have to get branch lengths for it.
# One way way to do this is to use datelife::datelife_search()
# Another way to do it is to make up teh branch lengths with ape::compute.brlen()
```

This will tell you if the taxon is monophyletic:
```{r}
rotl::is_in_tree(chiroptera_ott_id) 
```

```{r}
chiroptera_node_info <- rotl::tol_node_info(chiroptera_ott_id)
chiroptera_node_info
```

First task: Get and plot a tree of chiroptera families:
```{r}
chiroptera_families <- datelife::get_ott_children(ott_ids = chiroptera_ott_id, ott_rank = "family")
ls(chiroptera_families)
chiroptera_families
```

```{r Using Chiroptera Families to create tree}
chiroptera_families_subtree <- rotl::tol_induced_subtree(chiroptera_families$Chiroptera$ott_id)
```
```{r Observing Tree Info}
chiroptera_families_subtree
```
```{r Plotting Tree Of Chiroptera Families}
ape::plot.phylo(chiroptera_families_subtree, cex = .8)
```

Figure out how to get the ott ids as a vector.

```{r include=FALSE}
library(rmarkdown)
render("vignettes/report.Rmd", output_format="pdf")
```


```{r}
chiroptera_families$Chiroptera$ott_id
```

```{r}
c(chiroptera_families$Chiroptera$ott_id)
```
```{r}

```

```{r, inculde= FALSE}
# my_tree <- rotl::tol_induced_subtree(ott_ids = my_ott_ids)

# and plot the induced subtree
```

Task 2: Get an even smaller bat tree with 5 taxa that you like:
First get the scientific names of families, genera or species of bats.
Then run my_ott_ids <- rotl::tnrs_match_names to get the OTT ids

```{r}
my_ott_ids <- rotl::tnrs_match_names(c("Megadermatidae","Mormoopidae","Vespertilionidae","Mystacinidae","Furipteridae"))
```

```{r}
my_ott_ids
```

```{r}
my_tree <- rotl::tol_induced_subtree(my_ott_ids$ott_id)
```

```{r}
my_tree
```

```{r}
ape::plot.phylo(my_tree, cex = 1)
```












# Attributions
[bat image](https://unsplash.com/photos/hNz4Qh9ECCc)
